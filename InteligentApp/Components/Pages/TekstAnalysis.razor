@page "/tekst-analysis"
@using InteligentApp.Components.Models.AnalyzeTekstModels
@using System.Text.Json

<!--
    TekstAnalysis.razor
    Blazor component for Azure AI sentiment and key phrase analysis.
-->

<h3>Analiza tekstu z podziałem na sentyment i kluczowe frazy</h3>

<p>
    Wprowadź tekst, który zostanie przeanalizowany. Analiza będzie dotyczyć jego sentymentu.
    Wyodrębnione zostaną kluczowe frazy za pomocą Azure Ai Services
</p>

<div class="mb-3">
    <label for="textInput" class="form-label">Tekst do analizy:</label>
    <textarea id="textInput" class="form-control" rows="3" @bind="_textInput"></textarea>
</div>

<button class="btn btn-primary" @onclick="AnalyzeTextAsync">Analizuj tekst</button>

@if (_isLoading)
{
    <p class="mt-3">Proszę poczekać, analizuję tekst...</p>
}
else if (_showResult)
{
    <div>
        <h4>Wynik analizy:</h4>
        <p><strong>Sentyment:</strong> @_sentimentResult</p>
        <p><strong>Kluczowe frazy:</strong></p>
        <ul>
            @foreach (var phrase in _keyPhrases)
            {
                <li>@phrase</li>
            }
        </ul>
    </div>
}

@code {
    private string _textInput = string.Empty;
    private bool _isLoading = false;
    private bool _showResult = false;
    private string _sentimentResult = string.Empty;
    private List<string> _keyPhrases = new();
    
    [Inject]
    public IAzureLanguageService AzureLanguageService { get; set; }

    /// <summary>
    /// Main entry point for text analysis. Handles UI state and calls analysis methods.
    /// </summary>
    private async Task AnalyzeTextAsync()
    {
        if (string.IsNullOrWhiteSpace(_textInput))
        {
            _sentimentResult = "Proszę wprowadzić tekst do analizy.";
            _showResult = true;
            return;
        }

        _isLoading = true;
        _showResult = false;
        _keyPhrases.Clear();
        _sentimentResult = string.Empty;

        var sentiment = await AzureLanguageService.AnalyzeTextApiAsync(_textInput, "SentimentAnalysis");
        var keyPhrases = await AzureLanguageService.AnalyzeTextApiAsync(_textInput, "KeyPhraseExtraction");

        _sentimentResult = sentiment.Sentiment ?? "Brak wyniku sentymentu.";
        _keyPhrases = keyPhrases.KeyPhrases ?? new List<string>();
        _isLoading = false;
        _showResult = true;
    }
}
